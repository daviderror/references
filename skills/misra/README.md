//todo всe UB в UB Си, группа 8

## misra

+ [about](#about)
+ [tools](#tools)

`требования относительно стандарта`
+ [rule_1_1](#rule_1_1)
+ [rule_1_2](#rule_1_2)
+ [rule_1_3](#rule_1_3)

`требования относительно кода`
+ [rule_2_1](#rule_2_1)
+ [rule_2_2](#rule_2_2)
+ [rule_2_3](#rule_2_3)
+ [rule_2_4](#rule_2_4)
+ [rule_2_5](#rule_2_5)
+ [rule_2_6](#rule_2_6)
+ [rule_2_7](#rule_2_7)

`относительно коментариев`
+ [rule_3_1](#rule_3_1)
+ [rule_3_2](#rule_3_2)

`требования относительно набора символов и лексических согнлашений`
+ [rule_4_1](#rule_4_1)
+ [rule_4_2](#rule_4_2)

`требования относительно идентификаторов //todo ссылку на си`
+ [rule_5_1](#rule_5_1)
+ [rule_5_2](#rule_5_2)
+ [rule_5_3](#rule_5_3)
+ [rule_5_4](#rule_5_4)
+ [rule_5_5](#rule_5_5)
+ [rule_5_6](#rule_5_6)
+ [rule_5_7](#rule_5_7)
+ [rule_5_8](#rule_5_8)
+ [rule_5_9](#rule_5_9)

`требования относительно типов //todo ссылку на си`
+ [rule_6_1](#rule_6_1)
+ [rule_6_2](#rule_6_2)

`требования относительно литералов и констант`
+ [rule_7_1](#rule_7_1)
+ [rule_7_2](#rule_7_2)
+ [rule_7_3](#rule_7_3)
+ [rule_7_4](#rule_7_4)


## about
MISRA (motor industry software reliability association) - стандарт для обеспечения надежности ПО в разработке встраеваемых транспрортных систем (хотя используется во всех критически важных системах).

```
1998 - MISRA-C:1988 (93 обязательныз правил и 34 рекомендательных)
2004 - MISRA-C:2004 (121 обязательныз правил и 20 рекомендательных, правила разделили на 21 категорию)
2012 - MISRA-C:2012 (123 обязательныз правил и 20 рекомендательных, 16 директив - правила связанные с процессами и процедурами)
2016 - MISRA-C:2016 (дополнение)
2020 - MISRA-C:2020 (переиздание MISRA-C:2016)
```
группа 1 (rule_1_1 - rule_1_3) - требования относительно стандарта
группа 2 (rule_2_1 - rule_2_7) - требования относительно кода
группа 3 (rule_3_1 - rule_3_2) - требования относительно коментариев
группа 4 (rule_4_1 - rule_4_2) - требования относительно набора символов и лексических согнлашений
группа 5 (rule_5_1 - rule_5_9) - требования относительно идентификаторов //todo ссылку на си
группа 6 (rule_6_1 - rule_6_2) - требования относительно типов //todo ссылку на си
группа 7 (rule_7_1 - rule_7_4) - требования относительно литералов и констант //todo ссылку на си
группа 8 ( ) - требования относительно объявлений и определний

Уровни: Mandatory, Required, Advisory

## tools
cppcheck //todo ссылку

## rule_1_1
Required: Исходный код и его синтаксис должны соответвовать стандартам и ограничениям языка, а также не превышать ограничея транзакций имплементаций (вторая часть предложения хз что значит).

Это просто требование соблюдать синтаксис языка.

## rule_1_2
Advisory: Нельзя использовать языковые раширения кроме ассемблерных вставок.

## rule_1_3
Required: В программе не долны быть неопределенного поведения. //todo ссылка

Все случаи неопределенного поведения описанны в Appendix H -> H.1 стандарта Си.

## rule_2_1
Required: В проекте не должно быть не достижимого кода.
```
FILE *open_file(const char *file_name)
{
    FILE *f = fopen(file_name, "w");

    if (nullptr == f) {
    	exit(1);
    	printf("No such file: %s", file_name) // non-compliant, it is not reacheable
    }

	return f;
}
```
```
if (n < 10) return 10;
else if (n < 20) return 20;
else if (n < 30) return 30;
else if (n < 50) return 50;
else if (n < 40) return 40; // non-compliant, it is not reacheable
else if (n < 60) return 60;
```


## rule_2_2
Required: В коде не должно быть мертвого кода, те таких конструкций которые работают в холостую как, к примеру, пустые циклы.
```
extern volatile uint16_t v;

extern char *p;

void f(void)
{
	uint16_t x;

	(void) v;       // compliant, the cast to void is permited

	(uint32_t) v;   // non-compliant, operator is dead
	v >> 3;         // non-compliant, operator is dead
	x = 3;          // non-compliant, operator is dead, since x not read subsequently

	*p++;           // non-compliant, result is not used
	(*p)++;         // compliant, *p is incremented
}
```


`__asm("NOP");` - несчитается такой конструкцией.

Пустые функции не являются мёртвым кодом тк от их оптимизации работа программы не изменится.
```
void g (void) 
{

}

void h (void)
{
	g();
}
```
## rule_2_3
Advisory: В проекте не должны быть объявлены не используемые типы данных.

ТК не ясно забыто ли это по ошибке или является избыточным.

## rule_2_4
Advisory: В проекте не должны быть объявлены не используемые тэги.

ТК не ясно забыто ли это по ошибке или является избыточным.
```
typedef struct st {
	uint8_t a;
	uint8_t b;
	bool    c;
} rec;

bool unused_tag(void) 
{
	enum state (e_init, e_run, e_sleep); // non-compliant

    rec.c = true;

    return rec.c; // non-compliant, since in programm used only 'c' field
}
```

## rule_2_5
Advisory: В проекте не должны быть объявлены не используемые макросы.

ТК не ясно забыто ли это по ошибке или является избыточным.

## rule_2_6
Advisory: В проекте не должны быть объявлены не используемые лэйблэ `goto`.
```
string unused_label(int inc) 
{
	int c = 10 + inc;

	if (15 == c) {
		goto ret;
	} else {
        goto ret2;
	}

ret:
    return "ret"
ret2:
    return "ret2"
label:
    return "label"; // non-compliant, since label is unused
}
```

## rule_2_7
Advisory: В проекте не должны быть объявлены не используемые параметры функций тк не ясно ошибка это или нет.

## rule_3_1
Required: Последовательность //* и // не должны использоваться в коментариях типа //*/*/, тк изза этого можно упустить конец коментария, тем самым случайно закоментить кусок кода.
Исключение для // в коментариях типа //.

## rule_3_2
Required: Соединение строк не должно использоваться в // коментариях.
```
int d = 7; // some d \
if (x)                     <- изза \ в коментарии if(x) станет коментарием.
    d++;
```

## rule_4_1
Required: Восьмиричные и шестнадцетиричные ескейп последовательности, должны завершаться либо переходить на начало другой ескейп последовательности, либо на конец строкового литерала.

Это нужно чтобы не создавать путаницы в ескейп последовательности.
```
const char *s1 = "\x41g";     // non-compliant
const char *s2 = "\x41" "g";  // compliant - termenated by end of literal
const char *s3 = "\x41\x67";  // compliant - termenated by another escape

int c1 = '\141t'   // non-compliant
int c1 = '\141\t'  // compliant - termenated by another escape
```
## rule_4_2
Advisory: Три графа не должны использоваться. Те использование комбинации `?? и еще один символ` тк это может быть спутанно с токенами и интерпретироваться не как задуманно.

## rule_5_1
Required: Иденификаторы должны быть отчетливыми и иметь первые символы определяющие принадлежность этого индификатора.
Те иметь осмысленное название и быть не сильно большими. Иденитфикаторы должны отличаться как минимум несколькими символами в незначисмой части, но не регистром этих символов. Размер иденртификатора должен быть не больше 31 символа.

## rule_5_2
Required: Иденификаторы в одной области имен должны быть достаточно разными в незначемой части.

## rule_5_3
Required: Идентификаторы в неком блоке должен отличаться от идентификатора вне этого блока.
```
void f(void) 
{
	int t;

	{
        int t;

        t = 2;
	}
}

```

## rule_5_4
Required: Макроидентификаторы должны быть отличны от других макросов. Имена параметров макроса должны быть разными. Переменные в макросе должны иметь значимую часть макроса.

## rule_5_5
Required: Макроидентификаторы должны быть отличны от других идентификаторов.

## rule_5_6
Required: Идентификатор псевдонима типа, через `typedef`, должен быть каждый раз уникальным.

## rule_5_7
Required: Идентификатор тега должен быть каждый раз уникальным. Иначе может бытьт UB.

## rule_5_8
Required: Идентификаторы объектов, функций и тд, с внешней связью должны быть уникальными.

## rule_5_9
Advisory: Идентификаторы объектов, функций и тд, с внутренней связью должны быть уникальными.

## rule_6_1
Required: Битовые поля должны быть объявлены только с соответвующем типом.
Подходит любое целое число со знаком и без, а так же bool, можно использовать typedef. Числа с плавающей и фиксированной точков в этом случае могут вызвать UB.

## rule_6_2
Required: Однобиотовые именованные поля должны быть безнаковыми.

## rule_7_1
Required: Восмеричные константы не должны использоваться. Так как они могут быть интерпретированны не верно. Исключение для эскейп последовательностей и для цифры 0.

## rule_7_2
Required: Суффиксф U и u должны использоваться со всеми беззнаковыми целочисленными литералами.

## rule_7_3
Required: `I` не должно использоваться в литералах, тк похож на 1. `l` не должно использоваться в литералах, тк похож на 1, а использовать `L`.

## rule_7_4
Required: Строковый литерал не должен предназначен объекту не `const char *` или  `const wchar_t *`. Так как строковый литерал может быть случайно изменен, что приведет к UB.